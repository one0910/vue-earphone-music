import{m as d,u as o,L as S,b as g,c as f,_ as b,o as a,d as l,e as t,w as u,t as _,I as L,Q as y,s as R,h as x,a0 as k,R as $,F as C,G as I,g as m,J as P,n as A}from"./index-DWPRnIHM.js";import{u as h}from"./alertConfirm-DR4yquSD.js";import{a as z}from"./alertDeleteConfirm-QWwaTaNZ.js";const j={name:"FavSongItem",data(){return{isCurrentPlaying:!1}},props:{favSong:{type:Object,required:!0},index:{type:Number,required:!0},isFinshRender:{type:Function,required:!0}},computed:{...d(o,["playing","current_song","pauseCurrentSong"]),...d(S,["favSongList"]),...g(o,["playingIndex"]),...g(h,["delFavSong","isShowAlertConfirm"])},methods:{...f(o,["newSong"]),...f(h,["fireShowAlertConfirm"]),playSong(e){this.newSong(e),this.isCurrentPlaying=!0},delSongFromList(e,s){this.delFavSong.index=s,this.delFavSong.docID=e,this.fireShowAlertConfirm({msg:this.$t("alertMsg.delete_favsong",{favsongName:this.favSong.modified_name})})}},watch:{playing(){this.current_song&&(this.current_song.modified_name==this.favSong.modified_name?(this.isCurrentPlaying=!0,this.playingIndex=this.index):this.isCurrentPlaying=!1)},pauseCurrentSong(){this.pauseCurrentSong&&this.pauseCurrentSong.pause&&(this.current_song.modified_name==this.pauseCurrentSong.currentSong?this.isCurrentPlaying=!1:this.isCurrentPlaying=!0)}},mounted(){this.index===this.favSongList.length-1&&this.isFinshRender(!0)}},B={class:"w-12 mr-4"},q=["src"],H={class:"flex flex-1 justify-between border-b border-b-zinc-200/30 items-center"},N={class:"pr-3 flex-initial truncate md:w-80 w-44"},V={class:"text-zinc-500 text-sm"},E={class:"flex justify-between w-28"},M=t("p",{class:"flex-initial w-14 text-start"},"03:57",-1),O={class:"flex-initial md:text-center text-start"},W={key:0,class:"far fa-play-circle text-2xl text-rose-500/80"},G={key:1,class:"far fa-pause-circle text-2xl text-rose-500/80"};function J(e,s,n,w,i,r){return a(),l(L,null,[t("div",B,[t("img",{class:"rounded-md",src:n.favSong.coverImg,alt:""},null,8,q)]),t("div",H,[t("div",{class:"cursor-pointer pr-3 flex-1",onClick:s[0]||(s[0]=u(c=>r.playSong(n.favSong),["prevent"]))},[t("p",N,_(n.favSong.modified_name),1),t("p",V,_(n.favSong.display_name),1)]),t("div",E,[t("div",{class:"cursor-pointer flex items-center",onClick:s[1]||(s[1]=u(c=>r.playSong(n.favSong),["prevent"]))},[M,t("div",O,[i.isCurrentPlaying?(a(),l("i",G)):(a(),l("i",W))])]),t("div",null,[t("i",{class:"fas fa-minus-square text-2xl text-rose-500/80 cursor-pointer",onClick:s[2]||(s[2]=u(c=>r.delSongFromList(n.favSong.docID,n.index),["prevent"]))})])])])],64)}const Q=b(j,[["render",J]]),v="/assets/logo2-BpBPWk9v.png",U={data(){return{favSongs:[],currentSongCoverImg:v,listHeightStyle:""}},components:{FavSongItem:Q,AlertDeleteConfirm:z},computed:{...d(S,["uid"]),...d(o,["playing","current_song","pauseCurrentSong"]),...g(h,["delData","delFavSong"]),...g(S,["favSongList"]),...g(o,["songList","playingIndex"]),filter(){if(!this.current_song.coverImg&&this.songList.length===0)return{filter:"grayscale(50%)"}}},methods:{...f(h,["delFavSongItemDoc"]),...f(o,["deleteSong"]),async getFavSongList(){try{const e=await y.doc(this.uid).get();this.favSongList=e.data().favSongLists}catch(e){console.log("error => ",e)}},async getSongs(){try{this.favSongList.forEach(async e=>{const s=await R.doc(e).get();this.favSongs.push({...s.data(),docID:e}),this.songList.push({...s.data(),docID:e})})}catch(e){console.log("error => ",e)}},isFinshRender(e){e&&(this.songList.length>0&&(this.currentSongCoverImg=this.songList[0].coverImg),x.changeHightStyle(this.favSongList,this.$refs.listRef))}},async mounted(){this.songList=[],this.favSongList.length==0&&(this.playing?this.$refs.listRef.style.height="388px":this.$refs.listRef.style.height="418px"),await this.getFavSongList(),await this.getSongs(),k(()=>{this.favSongList.length===0&&(this.currentSongCoverImg=v)})},watch:{async delData(){if(this.delData){const e=this.delFavSong.index;try{await y.doc(this.uid).update({favSongLists:$.firestore.FieldValue.arrayRemove(this.favSongs[e].docID)})}catch(s){console.log("error => ",s);return}this.favSongs.splice(e,1),this.favSongList.splice(e,1),this.deleteSong(e),this.delData=!1,this.delFavSong={index:null,docID:""}}},current_song(){x.changeHightStyle(this.favSongList,this.$refs.listRef),Object.keys(this.current_song).length===0?this.currentSongCoverImg=v:this.currentSongCoverImg=this.current_song.favCoverImg?this.current_song.favCoverImg:this.current_song.coverImg}}},K={class:"bg-black/70 backdrop-blur-md w-full h-full"},T={class:"md:w-[550px] w-full bg-[#00000030] rounded md:border border-transparent md:border-gray-200/40 mx-auto"},X={class:"w-56 mx-auto"},Y=["src"],Z={class:"mt-2"},ee={class:"text-center"};function te(e,s,n,w,i,r){const c=C("AlertDeleteConfirm"),F=C("FavSongItem");return a(),l("main",{class:A(["text-zinc-200 bg-zinc-900 mt-[63px] relative",{"mb-[120px]":e.current_song.album}])},[I(c),t("div",{class:"bg-cover bg-center md:bg-fixed bg-no-repeat md:bg-cover h-full",style:m(`background-image: url(${i.currentSongCoverImg})`)},[t("div",K,[t("div",T,[t("div",X,[t("img",{src:i.currentSongCoverImg,style:m(r.filter),alt:""},null,12,Y)]),t("div",Z,[t("p",ee,_(e.$t("menu.play_list")),1)]),t("ul",{class:"md:mx-5 mx-5",style:m(i.listHeightStyle),ref:"listRef"},[(a(!0),l(L,null,P(i.favSongs,(p,D)=>(a(),l("li",{class:"flex justify-center my-2",key:p.docID},[I(F,{favSong:p,index:D,isFinshRender:r.isFinshRender},null,8,["favSong","index","isFinshRender"])]))),128))],4)])])],4)],2)}const re=b(U,[["render",te]]);export{re as default};
