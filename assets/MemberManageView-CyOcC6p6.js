import{P as D,b as $,h as v,_ as x,F as b,o as p,d as f,G as d,K as G,f as F,e as t,t as o,Z as N,a3 as V,a4 as P,H as U,n as w,I as y,a1 as M,m as E,L as R,c as z,X as _,A,s as S,R as j,J as C,w as T,a2 as H}from"./index-MWUSZCKJ.js";import{u as k}from"./alertConfirm-jY1Nzz_H.js";import{u as I}from"./albumInfo-EWyBBbI_.js";import{C as B}from"./CropperImag-TKTllpS9.js";import{a as W}from"./alertDeleteConfirm-BKXgOumg.js";const q={data(){return{toggle:!1,message:"",tempCropperFile:{},uploadSignerImgTempUrl:"",uploadAlbumImgTempUrl:"",uploadSchema:{albumSinger:"required",albumName:"required",albumGenre:"required",albumDesc:"required|min:3"},userData:{albumGenre:"America"}}},props:["isClose"],components:{ToastMessage:D,CropperImag:B},computed:{...$(I,["albumEditTemp"])},methods:{async uploadSignerImg(e){const{file:a,showAlert:l,message:r}=await v.uploadImg(e);if(l){this.toggle=!this.toggle,this.message=r;return}this.tempCropperFile={file:a,imageType:"signer"}},async uploadAlbumImg(e){const{file:a,showAlert:l,message:r}=await v.uploadImg(e);if(l){this.toggle=!this.toggle,this.message=r;return}this.tempCropperFile={file:a,imageType:"album"}},isCloseCropper(e={}){const{isClose:a,file:l,imgUrl:r,imgType:s}=e;s==="signer"?(this.uploadSignerImgTempUrl=r,this.albumEditTemp.albumUploadSingnerImgFile=l):s==="album"&&(this.uploadAlbumImgTempUrl=r,this.albumEditTemp.albumUploadAlbumImgFile=l),a&&(this.tempCropperFile={})}},watch:{isClose(){this.isClose||(this.uploadSignerImgTempUrl="",this.uploadAlbumImgTempUrl="")}}},O={class:"md:order-1 md:w-[50%] w-full rounded border border-gray-200/70 px-3"},K={class:"px-1 pt-6 pb-3 font-bold border-b border-gray-200 flex justify-between"},J={class:"card-title"},X=t("i",{class:"fa fa-music float-right text-rose-400 text-xl"},null,-1),Z={class:"flex justify-between gap-5 mt-3"},Q={class:"relative flex justify-center w-64 px-1 py-1 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-00 hover:text-white hover:bg-rose-500/40 hover:border-rose-500 hover:border-solid"},Y=["src"],ee={class:"absolute top-1 left-2 text-rose-500"},te={class:"relative flex justify-center w-64 px-1 py-1 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-00 hover:text-white hover:bg-rose-500/40 hover:border-rose-500 hover:border-solid"},ae=["src"],se={class:"absolute top-1 left-2 text-rose-500"},le=t("div",{class:"my-4 border-b-[1.5px] border-zinc-500"},null,-1),oe={class:"flex justify-start pl-1"},ne={class:"inline-flex items-center mb-3 cursor-pointer"},ie={class:"mr-5 truncate"},re=t("div",{class:"relative w-9 h-5 bg-white/20 border-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-rose-300 dark:peer-focus:ring-rose-500 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-rose-200 after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-rose-500"},null,-1),me={key:0,class:"truncate pl-2 text-emerald-500"},ue=t("i",{class:"fas fa-check-circle"},null,-1),de={key:1,class:"truncate pl-2 text-rose-600"},ce=t("i",{class:"fas fa-bell"},null,-1),ge={class:"flex gap-2 items-center mb-3"},be={class:"text-left"},pe={class:"flex gap-2 items-center mb-3"},he={class:"text-left"},fe={class:"flex gap-2 items-center mb-3"},_e={class:"bg-gray-700 text-zinc-100",value:"Acoustic"},we={class:"bg-gray-700 text-zinc-100",value:"Blues"},ye={class:"bg-gray-700 text-zinc-100",value:"Classical"},ve={class:"bg-gray-700 text-zinc-100",value:"Country"},Se={class:"bg-gray-700 text-zinc-100",value:"Dance"},Ie={class:"bg-gray-700 text-zinc-100",value:"Drones"},Ae={class:"bg-gray-700 text-zinc-100",value:"Dubstep"},Te={class:"bg-gray-700 text-zinc-100",value:"Easy Listening"},$e={class:"bg-gray-700 text-zinc-100",value:"Folk"},xe={class:"bg-gray-700 text-zinc-100",value:"Funk"},Ee={class:"bg-gray-700 text-zinc-100",value:"Hip Hop"},Ce={class:"bg-gray-700 text-zinc-100",value:"House"},ke={class:"bg-gray-700 text-zinc-100",value:"Kitsch"},De={class:"bg-gray-700 text-zinc-100",value:"Latin"},Me={class:"bg-gray-700 text-zinc-100",value:"March"},ze={class:"bg-gray-700 text-zinc-100",value:"Metal"},Pe={class:"bg-gray-700 text-zinc-100",value:"Opera"},Ue={class:"bg-gray-700 text-zinc-100",value:"Pop"},Re={class:"bg-gray-700 text-zinc-100",value:"Rock"},Le={class:"bg-gray-700 text-zinc-100",value:"Soul"},Ge={class:"bg-gray-700 text-zinc-100",value:"Urban / R&B"},Fe={class:"bg-gray-700 text-zinc-100",value:"World Music"},Ne={class:"bg-gray-700 text-zinc-100",value:"Other"},Ve={class:"text-left"},je={class:"flex gap-2 items-center mb-3"},He={class:"text-left"},Be={class:"flex gap-2 items-center mb-3"},We={class:"text-left"};function qe(e,a,l,r,s,n){const h=b("ToastMessage"),g=b("CropperImag"),i=b("vee-field"),u=b("ErrorMessage"),m=b("vee-form");return p(),f(y,null,[d(h,{toggle:s.toggle,message:s.message,success:!1},null,8,["toggle","message"]),s.tempCropperFile.file?(p(),G(g,{key:0,tempCropperFile:s.tempCropperFile,onIsCloseCropper:n.isCloseCropper},null,8,["tempCropperFile","onIsCloseCropper"])):F("",!0),t("div",O,[t("div",K,[t("span",J,o(e.$t("memberMamagePage.editAlbum.album_info")),1),X]),t("div",Z,[t("label",Q,[t("input",{type:"file",class:"hidden",onChange:a[0]||(a[0]=c=>n.uploadSignerImg(c))},null,32),t("img",{src:s.uploadSignerImgTempUrl?s.uploadSignerImgTempUrl:e.albumEditTemp.albumSingerImg,alt:""},null,8,Y),t("h6",ee,o(e.$t("makeAlbumPage.singer_photo")),1)]),t("label",te,[t("input",{type:"file",class:"hidden",onChange:a[1]||(a[1]=c=>n.uploadAlbumImg(c))},null,32),t("img",{src:s.uploadAlbumImgTempUrl?s.uploadAlbumImgTempUrl:e.albumEditTemp.albumImg,alt:""},null,8,ae),t("h6",se,o(e.$t("makeAlbumPage.album_cover")),1)])]),le,t("div",oe,[t("label",ne,[t("span",ie,o(e.$t("memberMamagePage.editAlbum.make_album_public"))+" :",1),N(t("input",{type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=c=>e.albumEditTemp.isRelease=c),class:"sr-only peer",onChange:a[3]||(a[3]=(...c)=>e.updateRelease&&e.updateRelease(...c))},null,544),[[V,e.albumEditTemp.isRelease]]),re,e.albumEditTemp.isRelease?(p(),f("span",me,[P(o(e.$t("memberMamagePage.editAlbum.album_is_public"))+" ",1),ue])):(p(),f("span",de,[P(o(e.$t("memberMamagePage.editAlbum.album_is_private"))+" ",1),ce]))])]),d(m,{"validation-schema":s.uploadSchema,"initial-values":s.userData},{default:U(()=>[t("div",ge,[t("label",{class:w({"w-20":e.$i18n.locale==="zh","w-28":e.$i18n.locale==="en",truncate:e.$i18n.locale==="en"})},o(e.$t("memberMamagePage.editAlbum.singer_name"))+" :",3),d(i,{type:"text",name:"albumSinger",class:"flex-1 py-1.5 px-3 bg-white/10 text-zinc-100 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:e.$t("memberMamagePage.editAlbum.singer_name"),modelValue:e.albumEditTemp.albumSinger,"onUpdate:modelValue":a[4]||(a[4]=c=>e.albumEditTemp.albumSinger=c)},null,8,["placeholder","modelValue"])]),t("div",be,[d(u,{class:"text-pink-600",name:"albumSinger"})]),t("div",pe,[t("label",{class:w({"w-20":e.$i18n.locale==="zh","w-28":e.$i18n.locale==="en",truncate:e.$i18n.locale==="en"})},o(e.$t("memberMamagePage.editAlbum.album_name"))+" :",3),d(i,{type:"text",name:"albumName",class:"flex-1 py-1.5 px-3 bg-white/10 text-zinc-100 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:e.$t("memberMamagePage.editAlbum.album_name"),modelValue:e.albumEditTemp.albumName,"onUpdate:modelValue":a[5]||(a[5]=c=>e.albumEditTemp.albumName=c)},null,8,["placeholder","modelValue"])]),t("div",he,[d(u,{class:"text-pink-600",name:"albumName"})]),t("div",fe,[t("label",{class:w({"w-20":e.$i18n.locale==="zh","w-28":e.$i18n.locale==="en",truncate:e.$i18n.locale==="en"})},o(e.$t("memberMamagePage.editAlbum.album_genre"))+" :",3),d(i,{as:"select",name:"albumGenre",class:"flex-1 h-10 max-w-[75%] md:max-w-full truncate px-3 bg-white/10 text-zinc-100 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",modelValue:e.albumEditTemp.albumGenre,"onUpdate:modelValue":a[6]||(a[6]=c=>e.albumEditTemp.albumGenre=c)},{default:U(()=>[t("option",_e,o(e.$t("makeAlbumPage.albumGenre.Acoustic")),1),t("option",we,o(e.$t("makeAlbumPage.albumGenre.Blues")),1),t("option",ye,o(e.$t("makeAlbumPage.albumGenre.Classical")),1),t("option",ve,o(e.$t("makeAlbumPage.albumGenre.Country")),1),t("option",Se,o(e.$t("makeAlbumPage.albumGenre.Dance_Electronica")),1),t("option",Ie,o(e.$t("makeAlbumPage.albumGenre.Drones")),1),t("option",Ae,o(e.$t("makeAlbumPage.albumGenre.Dubstep")),1),t("option",Te,o(e.$t("makeAlbumPage.albumGenre.Easy_Listening")),1),t("option",$e,o(e.$t("makeAlbumPage.albumGenre.Folk")),1),t("option",xe,o(e.$t("makeAlbumPage.albumGenre.Funk")),1),t("option",Ee,o(e.$t("makeAlbumPage.albumGenre.Hip_Hop")),1),t("option",Ce,o(e.$t("makeAlbumPage.albumGenre.House")),1),t("option",ke,o(e.$t("makeAlbumPage.albumGenre.Kitsch")),1),t("option",De,o(e.$t("makeAlbumPage.albumGenre.Latin")),1),t("option",Me,o(e.$t("makeAlbumPage.albumGenre.March"))+"/option> ",1),t("option",ze,o(e.$t("makeAlbumPage.albumGenre.Metal")),1),t("option",Pe,o(e.$t("makeAlbumPage.albumGenre.Opera")),1),t("option",Ue,o(e.$t("makeAlbumPage.albumGenre.Pop")),1),t("option",Re,o(e.$t("makeAlbumPage.albumGenre.Rock")),1),t("option",Le,o(e.$t("makeAlbumPage.albumGenre.Soul")),1),t("option",Ge,o(e.$t("makeAlbumPage.albumGenre.Urban_R&Bl")),1),t("option",Fe,o(e.$t("makeAlbumPage.albumGenre.World_Music")),1),t("option",Ne,o(e.$t("makeAlbumPage.albumGenre.Other")),1)]),_:1},8,["modelValue"])]),t("div",Ve,[d(u,{class:"text-pink-600",name:"albumGenre"})]),t("div",je,[t("label",{class:w({"w-20":e.$i18n.locale==="zh","w-28":e.$i18n.locale==="en",truncate:e.$i18n.locale==="en"})},o(e.$t("memberMamagePage.editAlbum.singer_desc"))+" :",3),d(i,{as:"textarea",name:"albumSingerDesc",class:"flex-1 py-1.5 px-3 h-20 bg-white/10 text-zinc-100 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:e.$t("memberMamagePage.editAlbum.singer_desc"),modelValue:e.albumEditTemp.albumSingerDesc,"onUpdate:modelValue":a[7]||(a[7]=c=>e.albumEditTemp.albumSingerDesc=c)},null,8,["placeholder","modelValue"])]),t("div",He,[d(u,{class:"text-pink-600",name:"albumSingerDesc"})]),t("div",Be,[t("label",{class:w({"w-20":e.$i18n.locale==="zh","w-28":e.$i18n.locale==="en",truncate:e.$i18n.locale==="en"})},o(e.$t("memberMamagePage.editAlbum.album_desc"))+" :",3),d(i,{as:"textarea",name:"albumDesc",class:"flex-1 py-1.5 px-3 h-20 bg-white/10 text-zinc-100 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:e.$t("memberMamagePage.editAlbum.album_desc"),modelValue:e.albumEditTemp.albumDesc,"onUpdate:modelValue":a[8]||(a[8]=c=>e.albumEditTemp.albumDesc=c)},null,8,["placeholder","modelValue"])]),t("div",We,[d(u,{class:"text-pink-600",name:"albumDesc"})])]),_:1},8,["validation-schema","initial-values"])])],64)}const Oe=x(q,[["render",qe]]),Ke={data(){return{showLoading:!1,toggle:!1,message:"",uploadsNesSongs:[],deleteAlbumSongs:[]}},props:["isClose"],components:{Loading:M,toastMessage:D},computed:{...$(I,["albumEditTemp"]),...E(R,["uid"])},methods:{...z(I,["initalbumEditTemp"]),async imageHandler(e){return new Promise((a,l)=>{const r=_.ref(),s=this.albumEditTemp.albumUploadSingnerImgFile,n=this.albumEditTemp.albumUploadAlbumImgFile,h=_.refFromURL(this.albumEditTemp.albumSingerImg),g=_.refFromURL(this.albumEditTemp.albumImg);if(e==="singerImg"&&s.lastModified){const u=r.child(`images/${s.name}`).put(s);u.on("state_changed",m=>{},m=>{console.error("error => ",m),l(m)},async()=>{try{await h.delete();const m=await u.snapshot.ref.getDownloadURL();a(m)}catch(m){console.error("error => ",m)}})}else if(e==="albumImg"&&n.lastModified){const u=r.child(`images/${n.name}`).put(n);u.on("state_changed",m=>{},m=>{console.error("error => ",m),l(m)},async()=>{try{await g.delete();const m=await u.snapshot.ref.getDownloadURL();console.log("ImgUrl_album => ",m),a(m)}catch(m){console.error("error => ",m)}})}else a()})},async updateAlbumData(){const e=A.doc("fundraising"),a=await e.get(),l=e.collection(this.uid).doc(this.albumEditTemp.albumID),r={...this.albumEditTemp,albumGenre:this.albumEditTemp.albumGenre.toLocaleLowerCase()};delete r.albumUploadAlbumImgFile,delete r.albumUploadSingnerImgFile,delete r.albumSongs,delete r.isLoading;const s=a.data().items.map(n=>this.albumEditTemp.albumID===n.albumID?{...n,...r}:n);await e.update({items:s}),await l.update({...r})},async updateSongData(){console.log("this.albumEditTemp => ",this.albumEditTemp),(await S.where("albumID","==",this.albumEditTemp.albumSongs[0].albumID).get()).forEach(a=>{a.ref.update({display_name:this.albumEditTemp.albumSinger,coverImg:this.albumEditTemp.albumImg,album:this.albumEditTemp.albumName})})},addNewSong(e){[...e.target.files].forEach(l=>{if(l.type!=="audio/mpeg"){this.toggle=!this.toggle,this.message=this.$t("alertMsg.non_mp3_file_alert",{file:l.name});return}this.uploadsNesSongs.push(l)})},deleteAlbumSong(e,a,l){this.albumEditTemp.albumSongs.length>1?(this.deleteAlbumSongs.push({songUrl:e,docID:a}),this.albumEditTemp.albumSongs.splice(l,1)):(this.toggle=!this.toggle,this.message=this.$t("alertMsg.at_leaset_one_alert"))},async deleteSongFromStorage(){const e=this.deleteAlbumSongs;if(!(e.length<1))return new Promise((a,l)=>{e.forEach(async(r,s)=>{const n=_.refFromURL(r.songUrl);console.log("songRef => ",n);try{await n.delete(),await S.doc(r.docID).delete(),s===e.length-1&&a()}catch(h){console.log("catch_error => ",h)}})})},async storeToSong(){const e=this.uploadsNesSongs;if(!(e.length<1))return new Promise((a,l)=>{e.forEach((r,s)=>{const g=_.ref().child(`fundraising_songss/${r.name}`).put(r);g.on("state_changed",i=>{},i=>{console.log("task_error => ",i)},async()=>{try{const i={albumID:this.albumEditTemp.albumID,album:this.albumEditTemp.albumName,coverImg:this.albumEditTemp.albumImg,uid:this.uid,display_name:this.albumEditTemp.albumSinger,original_name:g.snapshot.ref.name,modified_name:v.formatSongName(g.snapshot.ref.name),genre:this.albumEditTemp.albumGenre.toLowerCase(),comment_count:0,type:"member_fundingraise",createdAt:j.firestore.FieldValue.serverTimestamp()};i.url=await g.snapshot.ref.getDownloadURL(),await S.add(i),s===e.length-1&&a()}catch(i){console.log("catch_error => ",i);return}})})})},async submitHandler(){this.showLoading=!0,this.albumEditTemp.albumSingerImg=await this.imageHandler("singerImg")||this.albumEditTemp.albumSingerImg,this.albumEditTemp.albumImg=await this.imageHandler("albumImg")||this.albumEditTemp.albumImg,await this.updateAlbumData(),await this.updateSongData(),await this.storeToSong(),await this.deleteSongFromStorage(),window.location.reload()},deleteNewSong(e){this.uploadsNesSongs.length<1||this.uploadsNesSongs.splice(e,1)},formatIndex:v.formatIndex,formatSongName:v.formatSongName},watch:{isClose(){this.isClose||(this.deleteAlbumSongs=[],this.uploadsNesSongs=[])}}},Je={class:"md:order-2 flex-1 rounded border border-gray-200/70 px-3"},Xe={class:"px-1 pt-6 pb-3 font-bold border-b border-gray-200 flex justify-between"},Ze={class:"card-title"},Qe=t("i",{class:"fa fa-upload float-right text-rose-400 text-xl"},null,-1),Ye={class:"mt-3"},et={class:"flex items-center justify-between"},tt={class:"overflow-hidden flex items-center"},at=t("i",null,null,-1),st={class:"pl-2 truncate"},lt={class:""},ot=["onClick"],nt=t("i",{class:"fa fa-times"},null,-1),it=[nt],rt={class:"flex items-center justify-between"},mt={class:"overflow-hidden flex items-center"},ut=t("span",{class:"text-rose-500 italic"},"new",-1),dt={class:"pl-2 truncate"},ct={class:""},gt=["onClick"],bt=t("i",{class:"fa fa-times"},null,-1),pt=[bt],ht={class:"flex justify-between items-center mb-3"},ft={class:"cursor-pointer"},_t=t("i",{class:"fas fa-plus-square text-rose-500 text-3xl md:text-2xl"},null,-1);function wt(e,a,l,r,s,n){const h=b("Loading"),g=b("toastMessage");return p(),f(y,null,[d(h,{isShow:s.showLoading},null,8,["isShow"]),d(g,{toggle:s.toggle,message:s.message,success:!1},null,8,["toggle","message"]),t("div",Je,[t("div",Xe,[t("span",Ze,o(e.$t("memberMamagePage.editAlbum.uploaded_song_list")),1),Qe]),t("div",Ye,[(p(!0),f(y,null,C(e.albumEditTemp.albumSongs,(i,u)=>(p(),f("div",{key:u,class:"border border-zinc-200 p-2 mb-4 rounded font-bold text-sm"},[t("div",et,[t("div",tt,[at,t("p",st,o(n.formatIndex(u))+". "+o(i.modified_name),1)]),t("div",lt,[t("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-rose-600",onClick:T(m=>n.deleteAlbumSong(i.url,i.docID,u),["prevent"])},it,8,ot)])])]))),128)),(p(!0),f(y,null,C(s.uploadsNesSongs,(i,u)=>(p(),f("div",{key:i.lastModified,class:"border border-zinc-200 p-2 mb-4 rounded text-sm"},[t("div",rt,[t("div",mt,[ut,t("p",dt,o(n.formatSongName(i.name)),1)]),t("div",ct,[t("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-rose-600",onClick:T(m=>n.deleteNewSong(u),["prevent"])},pt,8,gt)])])]))),128)),t("div",ht,[t("label",ft,[t("input",{type:"file",class:"hidden",multiple:"",onChange:a[0]||(a[0]=i=>n.addNewSong(i))},null,32),_t]),t("button",{type:"button",class:"w-auto py-1 px-3 rounded text-zinc-100 bg-rose-500 w-30 hover:bg-rose-600 disabled:bg-zinc-700 disabled:text-zinc-400",onClick:a[1]||(a[1]=(...i)=>n.submitHandler&&n.submitHandler(...i))},o(e.$t("button.confirm")),1)])])])],64)}const yt=x(Ke,[["render",wt]]),vt={data(){return{close:!0,showLoading:!1}},props:["toggle","albumID"],emits:["closeTheWindow"],components:{SongInfoEdit:Oe,SongUploadedEdit:yt,Loading:M},computed:{...E(k,["isShowAlertConfirm"]),...E(R,["uid"]),...$(I,["albumEditTemp"])},methods:{...z(I,["initalbumEditTemp"]),closeAlbumInfo(){this.close=!0,this.$emit("closeTheWindow",{closed:!0}),this.initalbumEditTemp()},async getAlbumData(e){this.showLoading=!0;const l=(await A.doc("fundraising").collection(this.uid).doc(e).get()).data();this.albumEditTemp.albumDesc=l.albumDesc,this.albumEditTemp.isRelease=l.isRelease,this.albumEditTemp.albumGenre=l.albumGenre[0].toUpperCase()+l.albumGenre.substring(1),this.albumEditTemp.albumID=l.albumID,this.albumEditTemp.albumImg=l.albumImg,this.albumEditTemp.albumName=l.albumName,this.albumEditTemp.albumSinger=l.albumSinger,this.albumEditTemp.albumSingerDesc=l.albumSingerDesc,this.albumEditTemp.albumSingerImg=l.albumSingerImg},async getSongs(e){(await S.where("albumID","==",e).get()).forEach(l=>{this.albumEditTemp.albumSongs.push({...l.data(),docID:l.id})})}},watch:{toggle(){this.close=!1},async albumID(){this.albumID&&(await this.getAlbumData(this.albumID),await this.getSongs(this.albumID),this.showLoading=!1)}}},St={class:"relative top-[10px] md:m-auto w-full max-w-5xl h-auto"},It={class:"relative py-2 text-center bg-zinc-800 rounded-lg shadow dark:bg-gray-800"},At=t("svg",{"aria-hidden":"true",class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),Tt=t("span",{class:"sr-only"},"Close modal",-1),$t=[At,Tt],xt={class:"mx-2 flex justify-between md:flex-row flex-col gap-3"};function Et(e,a,l,r,s,n){const h=b("Loading"),g=b("SongInfoEdit"),i=b("SongUploadedEdit");return p(),f(y,null,[d(h,{isShow:s.showLoading},null,8,["isShow"]),t("div",{tabindex:"-1","aria-hidden":"true",class:w(["overflow-y-auto overflow-x-hidden fixed top-0 bg-gray-900/70 right-0 left-0 z-40 justify-center items-center w-full md:inset-0 h-modal h-full px-3 md:px-0",{hidden:s.close}])},[t("div",St,[t("div",It,[t("button",{type:"button",class:"text-gray-400 absolute top-2.5 right-2.5 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white",onClick:a[0]||(a[0]=(...u)=>n.closeAlbumInfo&&n.closeAlbumInfo(...u))},$t),t("div",xt,[d(g,{isClose:s.close},null,8,["isClose"]),d(i,{isClose:s.close},null,8,["isClose"])])])])],2)],64)}const Ct=x(vt,[["render",Et]]),kt={name:"Member-Manage",data(){return{deleteTempAlbum:{},albums:[],albumID:"",profileName:"",unsaveFlag:!1,toggle:!1,showLoading:!1}},components:{toastMessage:D,MemberSongEdit:Ct,alertDeleteConfirm:W,Loading:M},computed:{...$(k,["delData","deleteData","alertMessage"])},methods:{...z(k,["fireShowAlertConfirm"]),async openAlbum(e){this.toggle=!this.toggle,this.albumID=e},async getAlbums(e){const{albums:a,name:l}=(await H.doc(e).get()).data();(await A.doc("fundraising").collection(e).orderBy("createdAt","desc").get()).forEach(s=>{this.albums.push({...s.data()})}),this.profileName=l,a&&a.forEach(s=>{})},async deleteAlbum(e,a){this.deleteTempAlbum={...e,index:a,urls:[]},this.fireShowAlertConfirm({msg:this.$t("alertMsg.delete_album",{albumName:e.albumName})})},async deleteAlbumCollection(){const e=A.doc("fundraising"),a=await e.get(),l=e.collection(this.deleteTempAlbum.uid).doc(this.deleteTempAlbum.albumID),r=a.data().items.filter(s=>this.deleteTempAlbum.albumID!==s.albumID);try{await l.delete(),await e.update({items:r})}catch(s){console.log("deleteAlbumCollection_error => ",s)}},async deleteSongCollection(){const e=await S.where("albumID","==",this.deleteTempAlbum.albumID).get();try{e.forEach(async a=>{this.deleteTempAlbum.urls.push(a.data().url),await a.ref.delete()})}catch(a){console.log("deleteSongCollection_error => ",a)}},async deleteImgStorage(){const e=_.refFromURL(this.deleteTempAlbum.albumImg),a=_.refFromURL(this.deleteTempAlbum.albumSingerImg);try{await e.delete(),await a.delete()}catch(l){console.log("deleteImgStorage_error => ",l)}},async deleteSongStorage(){try{this.deleteTempAlbum.urls.forEach(async(e,a)=>{await _.refFromURL(e).delete()})}catch(e){console.log("deleteSongStorage => ",e)}},closeTheWindow(e){e.closed===!0&&(this.albumID="")}},watch:{async delData(){this.delData&&(this.showLoading=!0,await this.deleteAlbumCollection(),await this.deleteSongCollection(),await this.deleteImgStorage(),await this.deleteSongStorage(),window.location.reload())},alertMessage(){this.alertMessage||(this.deleteTempAlbum={})}},mounted(){this.getAlbums(this.$route.params.uid)}},Dt={class:"text-zinc-200 bg-zinc-900 mt-[55px] pt-[10px] pb-[10px] mb-[90px] relative"},Mt={class:"p-6 md:w-[550px] w-full bg-gradient-to-b from-zinc-900 to-zinc-700 rounded md:border border-transparent md:border-gray-200/40 mx-auto"},zt={class:"flex justify-around gap-0 items-center"},Pt={class:"text-gray-500 flex justify-center w-28 h-28 rounded-full border-2 border-zinc-500"},Ut=t("svg",{"data-encore-id":"icon",role:"img",viewBox:"0 0 24 24",fill:"currentColor",class:"w-16 h-1w-16"},[t("path",{d:"M10.165 11.101a2.5 2.5 0 0 1-.67 3.766L5.5 17.173A2.998 2.998 0 0 0 4 19.771v.232h16.001v-.232a3 3 0 0 0-1.5-2.598l-3.995-2.306a2.5 2.5 0 0 1-.67-3.766l.521-.626.002-.002c.8-.955 1.303-1.987 1.375-3.19.041-.706-.088-1.433-.187-1.727a3.717 3.717 0 0 0-.768-1.334 3.767 3.767 0 0 0-5.557 0c-.34.37-.593.82-.768 1.334-.1.294-.228 1.021-.187 1.727.072 1.203.575 2.235 1.375 3.19l.002.002.521.626zm5.727.657-.52.624a.5.5 0 0 0 .134.753l3.995 2.306a5 5 0 0 1 2.5 4.33v2.232H2V19.77a5 5 0 0 1 2.5-4.33l3.995-2.306a.5.5 0 0 0 .134-.753l-.518-.622-.002-.002c-1-1.192-1.735-2.62-1.838-4.356-.056-.947.101-1.935.29-2.49A5.713 5.713 0 0 1 7.748 2.87a5.768 5.768 0 0 1 8.505 0 5.713 5.713 0 0 1 1.187 2.043c.189.554.346 1.542.29 2.489-.103 1.736-.838 3.163-1.837 4.355m-.001.001z"})],-1),Rt={class:"md:w-64 w-44"},Lt=t("hr",{class:"my-6"},null,-1),Gt={class:"mb-3"},Ft={class:"grid grid-cols-4 gap-2"},Nt=["onClick"],Vt=["src","onClick"];function jt(e,a,l,r,s,n){const h=b("Loading"),g=b("alertDeleteConfirm"),i=b("toastMessage"),u=b("MemberSongEdit");return p(),f("main",Dt,[d(h,{isShow:s.showLoading},null,8,["isShow"]),d(g),d(i),d(u,{toggle:s.toggle,albumID:s.albumID,onCloseTheWindow:n.closeTheWindow},null,8,["toggle","albumID","onCloseTheWindow"]),t("div",Mt,[t("div",zt,[t("label",Pt,[t("input",{type:"file",class:"hidden",onChange:a[0]||(a[0]=m=>e.uploadSignerImg(m))},null,32),Ut]),t("div",Rt,[t("h5",null,o(e.$t("memberMamagePage.profile")),1),t("p",null,o(s.profileName),1)])]),Lt,t("p",Gt,o(e.$t("memberMamagePage.created_album")),1),t("div",Ft,[(p(!0),f(y,null,C(s.albums,(m,c)=>(p(),f("div",{key:m.albumID,class:"col-span-1 cursor-pointer relative"},[t("i",{class:"fas fa-trash-alt absolute left-1 text-rose-500 hover:text-teal-500 text-xl",onClick:T(L=>n.deleteAlbum(m,c),["prevent"])},null,8,Nt),t("img",{class:"rounded-md",src:m.albumImg,alt:"",onClick:T(L=>n.openAlbum(m.albumID),["prevent"])},null,8,Vt)]))),128))])])])}const Kt=x(kt,[["render",jt]]);export{Kt as default};
